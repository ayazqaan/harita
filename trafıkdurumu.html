<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>Viteska â€“ Trafik Durumu</title>
<style>
  :root{ --brand:#f27405; }
  *{ box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
  html,body{ margin:0; height:100%; font-family:'Segoe UI',sans-serif; }

  /* Harita */
  #map{ width:100vw; height:100vh; }

  /* Ãœst bilgi Ã§ubuÄŸu */
  .legend-bar{
    position:fixed; top:0; left:50%; transform:translateX(-50%);
    display:flex; justify-content:center; align-items:center; gap:10px;
    background:#fff; border-bottom:2px solid #ffe2c2;
    box-shadow:0 3px 14px rgba(242,116,5,.15);
    padding:8px 12px; border-radius:0 0 12px 12px;
    z-index:5;
  }
  .legend-item{ display:flex; align-items:center; gap:6px; font-weight:700; color:#333; font-size:.92rem; }
  .legend-color{ width:18px; height:10px; border-radius:4px; box-shadow:0 0 4px #0002; }

  /* Alt buton */
  .traffic-toggle{
    position:fixed; left:50%; bottom:14px; transform:translateX(-50%);
    background:#fff; color:var(--brand);
    border:2px solid #ffd9b5; border-radius:14px;
    padding:10px 16px; font-weight:900; cursor:pointer;
    box-shadow:0 6px 18px rgba(242,116,5,.15);
    z-index:6;
  }

  /* Genel bilgilendirme kutusu */
  .info-box{
    position:fixed;
    left:50%; transform:translateX(-50%);
    top:70px;
    background:#fff;
    padding:12px 16px;
    border-radius:14px;
    box-shadow:0 6px 18px rgba(0,0,0,.12);
    width:90%;
    max-width:400px;
    z-index:5;
    border-left:5px solid var(--brand);
    font-size:.93rem;
  }
  .info-title{
    font-weight:800; font-size:1rem; margin-bottom:6px; color:#333;
  }
  .info-sub{
    font-size:.8rem; color:#666; margin-top:4px;
  }

  /* AÅŸaÄŸÄ±dan Ã§Ä±kan trafik detay paneli */
  .traffic-panel{
    position:fixed;
    left:50%;
    bottom:0;
    transform:translate(-50%, 110%);
    transition:transform .28s ease;
    width:100%;
    max-width:480px;
    background:#fff;
    box-shadow:0 -6px 18px rgba(0,0,0,.22);
    border-radius:18px 18px 0 0;
    padding:12px 16px 16px;
    z-index:7;
  }
  .traffic-panel.show{
    transform:translate(-50%, 0);
  }
  .panel-header{
    display:flex; justify-content:space-between; align-items:center;
    margin-bottom:6px;
  }
  .panel-title{
    font-weight:800; font-size:1rem; color:#333;
  }
  .panel-chip{
    font-size:.72rem; padding:4px 8px;
    border-radius:999px; font-weight:700;
    background:#f5f5f5;
  }
  .panel-delay{
    font-size:.94rem; margin:6px 0; font-weight:700;
  }
  .panel-reason{
    font-size:.86rem; color:#555; margin-bottom:4px;
  }
  .panel-suggestion{
    font-size:.86rem; color:#333; margin-top:4px;
  }
  .panel-alt{
    font-size:.8rem; color:#777; margin-top:4px;
  }
  .panel-close{
    border:none; background:transparent; font-size:1.2rem; cursor:pointer; padding:4px; color:#777;
  }

  .panel-badge-row{
    display:flex; gap:6px; flex-wrap:wrap; margin-top:6px;
  }
  .panel-badge{
    font-size:.72rem; padding:3px 7px; border-radius:999px; background:#fff4ea; color:#a85b16; border:1px solid #ffd1a1;
  }

  /* KullanÄ±cÄ± konumu iÃ§in animasyonlu alan (pulse) - JS ile Circle da var ama gÃ¶rsel destek iÃ§in */
  .user-status-pill{
    position:fixed;
    right:10px;
    top:76px;
    background:#ffffff;
    border-radius:999px;
    box-shadow:0 3px 12px rgba(0,0,0,.15);
    padding:6px 10px;
    display:flex;
    align-items:center;
    gap:6px;
    font-size:.78rem;
    z-index:6;
  }
  .user-dot{
    width:10px; height:10px; border-radius:50%;
    background:#00c853;
    position:relative;
    overflow:visible;
  }
  .user-dot::after{
    content:"";
    position:absolute;
    left:50%; top:50%;
    width:10px; height:10px;
    border-radius:50%;
    border:2px solid rgba(0,200,83,.6);
    transform:translate(-50%,-50%);
    animation:pulseDot 1.4s infinite;
  }
  @keyframes pulseDot{
    0%{ transform:translate(-50%,-50%) scale(1); opacity:.9; }
    100%{ transform:translate(-50%,-50%) scale(2.3); opacity:0; }
  }

</style>
</head>
<body>

  <!-- Ãœstteki renk efsanesi aynÄ± kaldÄ± -->
  <div class="legend-bar">
    <div class="legend-item"><div class="legend-color" style="background:#00c853;"></div> AkÄ±cÄ±</div>
    <div class="legend-item"><div class="legend-color" style="background:#ffeb3b;"></div> YoÄŸun</div>
    <div class="legend-item"><div class="legend-color" style="background:#ff5722;"></div> SÄ±kÄ±ÅŸÄ±k</div>
    <div class="legend-item"><div class="legend-color" style="background:#9e9e9e;"></div> KapalÄ±</div>
  </div>

  <!-- Genel bilgi kutusu -->
  <div class="info-box" id="infoBox">
    <div class="info-title">ðŸš¦ CanlÄ± Trafik GÃ¶rÃ¼nÃ¼mÃ¼</div>
    Harita, bulunduÄŸun konumu <b>yeÅŸil araÃ§ ikonu</b> ile gÃ¶sterir. YakÄ±ndaki trafik noktalarÄ±na tÄ±kladÄ±ÄŸÄ±nda,
    <b>tahmini gecikme sÃ¼resi</b> ve <b>alternatif rota Ã¶nerileri</b> bu sayfada listelenir.
    <div class="info-sub">Ä°pucu: HaritayÄ± yakÄ±nlaÅŸtÄ±rdÄ±kÃ§a daha detaylÄ± nokta gÃ¶rebilirsin.</div>
  </div>

  <!-- KullanÄ±cÄ± durum pill'i -->
  <div class="user-status-pill">
    <div class="user-dot"></div>
    <span id="userStatusText">Konum bekleniyorâ€¦</span>
  </div>

  <!-- Trafik detay paneli -->
  <div class="traffic-panel" id="trafficPanel">
    <div class="panel-header">
      <div>
        <div class="panel-title" id="panelTitle">Trafik NoktasÄ±</div>
        <div class="panel-reason" id="panelReason">Durum bilgisi yÃ¼kleniyor...</div>
      </div>
      <button class="panel-close" id="panelCloseBtn" aria-label="Kapat">âœ•</button>
    </div>
    <div class="panel-delay" id="panelDelay">Tahmini gecikme: - dk</div>
    <div class="panel-suggestion" id="panelSuggestion"></div>
    <div class="panel-alt" id="panelAlt"></div>

    <div class="panel-badge-row">
      <div class="panel-badge" id="panelLevelBadge">YoÄŸunluk: -</div>
      <div class="panel-badge">Viteska Tavsiye ModÃ¼lÃ¼</div>
    </div>
  </div>

  <div id="map"></div>
  <button id="toggleBtn" class="traffic-toggle" aria-pressed="true">Trafik: AÃ‡IK</button>

<script>
let map, trafficLayer;
let userMarker = null;
let userCircle = null;
let userHasCentered = false;
let circleAnimInterval = null;
let trafficMarkers = [];

// Basit trafik noktalarÄ± datasÄ± (Ã¶rnek) â€“ merkez etrafÄ±na yerleÅŸtiriyoruz:
function getSampleTrafficPoints(center){
  const baseLat = center.lat();
  const baseLng = center.lng();
  return [
    {
      title:"Åžehir Merkezi KavÅŸaÄŸÄ±",
      level:"SÄ±kÄ±ÅŸÄ±k",
      delayMin:18,
      reason:"AkÅŸam iÅŸ Ã§Ä±kÄ±ÅŸÄ± yoÄŸunluÄŸu",
      suggestion:"MÃ¼mkÃ¼nse bir sonraki kavÅŸaktan dÃ¶nerek paralel caddeyi kullan.",
      alt:"Toplu taÅŸÄ±ma kullanma imkÃ¢nÄ±n varsa bu saatlerde araÃ§ yerine onu tercih etmek sÃ¼reni kÄ±saltabilir.",
      position:{lat:baseLat+0.015,lng:baseLng+0.01}
    },
    {
      title:"Ana Bulvar â€“ Yol Ã‡alÄ±ÅŸmasÄ±",
      level:"YoÄŸun",
      delayMin:12,
      reason:"Tek ÅŸeride dÃ¼ÅŸen yol Ã§alÄ±ÅŸmasÄ±",
      suggestion:"Ã‡alÄ±ÅŸma bitene kadar bir alt veya Ã¼st paralel caddeyi tercih et. Navigasyondan alternatif rotayÄ± kontrol et.",
      alt:"KÄ±sa mesafelerde U dÃ¶nÃ¼ÅŸÃ¼ yaparak Ã§alÄ±ÅŸmanÄ±n bittiÄŸi noktadan tekrar ana yola baÄŸlanabilirsin.",
      position:{lat:baseLat-0.012,lng:baseLng-0.008}
    },
    {
      title:"Ã‡evreyolu GiriÅŸi",
      level:"AkÄ±cÄ±",
      delayMin:3,
      reason:"AkÄ±cÄ± fakat yoÄŸunluk artma eÄŸiliminde",
      suggestion:"Åžu anda Ã§evreyolu daha avantajlÄ± gÃ¶rÃ¼nÃ¼yor, uzun mesafe gideceksen burayÄ± kullanabilirsin.",
      alt:"YoÄŸunluk artarsa uygulama Ã¼zerindeki diÄŸer kavÅŸak noktalarÄ±nÄ± da kontrol etmeyi unutma.",
      position:{lat:baseLat+0.02,lng:baseLng-0.005}
    },
    {
      title:"KÃ¶prÃ¼ Ã–ncesi Åžerit DaralmasÄ±",
      level:"Ã‡ok SÄ±kÄ±ÅŸÄ±k",
      delayMin:26,
      reason:"KÃ¶prÃ¼ giriÅŸi ve ÅŸerit daralmasÄ±",
      suggestion:"KÃ¶prÃ¼ye girmeden Ã¶nceki son Ã§Ä±kÄ±ÅŸtan ÅŸehir iÃ§i baÄŸlantÄ± yoluna girerek bekleme sÃ¼reni azaltabilirsin.",
      alt:"YoÄŸunluk kÄ±sa sÃ¼rede azalacak gibi gÃ¶rÃ¼nmÃ¼yorsa kÃ¶prÃ¼ yerine alternatif gÃ¼zergÃ¢h dÃ¼ÅŸÃ¼nÃ¼lebilir.",
      position:{lat:baseLat-0.02,lng:baseLng+0.015}
    }
  ];
}

function getLevelColor(level){
  switch(level){
    case "AkÄ±cÄ±": return "#00c853";
    case "YoÄŸun": return "#ffeb3b";
    case "SÄ±kÄ±ÅŸÄ±k": return "#ff5722";
    case "Ã‡ok SÄ±kÄ±ÅŸÄ±k": return "#d50000";
    default: return "#9e9e9e";
  }
}

function updateUserStatus(text){
  const el = document.getElementById('userStatusText');
  if(el) el.textContent = text;
}

function openTrafficPanel(data){
  const panel = document.getElementById('trafficPanel');
  document.getElementById('panelTitle').textContent = "ðŸ“ " + data.title;
  document.getElementById('panelReason').textContent = "Durum: " + data.reason;
  document.getElementById('panelDelay').textContent = "Tahmini gecikme: " + data.delayMin + " dk";
  document.getElementById('panelSuggestion').textContent = "ðŸš— Ã–neri: " + data.suggestion;
  document.getElementById('panelAlt').textContent = "â„¹ " + data.alt;

  const levelBadge = document.getElementById('panelLevelBadge');
  levelBadge.textContent = "YoÄŸunluk: " + data.level;
  levelBadge.style.color = "#000";
  levelBadge.style.borderColor = getLevelColor(data.level);
  levelBadge.style.background = "#fffdf4";

  panel.classList.add('show');

  // Ãœstteki infoBox iÃ§eriÄŸini de kÄ±saca gÃ¼ncelle
  const infoBox = document.getElementById('infoBox');
  if(infoBox){
    infoBox.querySelector('.info-title').textContent = "SeÃ§ili BÃ¶lge: " + data.title;
  }
}

function closeTrafficPanel(){
  const panel = document.getElementById('trafficPanel');
  panel.classList.remove('show');
}

function initTrafficPoints(){
  const center = map.getCenter();
  const points = getSampleTrafficPoints(center);

  points.forEach(p=>{
    const marker = new google.maps.Marker({
      position:p.position,
      map:map,
      title:p.title,
      icon:{
        url:"data:image/svg+xml;utf-8," +
          "<svg xmlns='http://www.w3.org/2000/svg' width='34' height='34'>" +
          "<circle cx='17' cy='17' r='12' fill='" + getLevelColor(p.level) + "' stroke='white' stroke-width='3' />" +
          "<text x='17' y='21' text-anchor='middle' font-size='14' fill='#000' font-family='Segoe UI'>T</text>" +
          "</svg>",
        scaledSize:new google.maps.Size(30,30)
      }
    });

    marker.addListener('click', ()=> openTrafficPanel(p));
    trafficMarkers.push(marker);
  });
}

function startCircleAnimation(){
  if(!userCircle || circleAnimInterval) return;
  const baseRadius = 70;
  circleAnimInterval = setInterval(()=>{
    const t = Date.now() / 700;
    const r = baseRadius + Math.sin(t) * 30;
    userCircle.setRadius(r);
  }, 160);
}

function initMap(){
  map = new google.maps.Map(document.getElementById('map'), {
    center:{lat:39.92077,lng:32.85411}, // Ankara default
    zoom:12,
    mapTypeControl:false, streetViewControl:false, fullscreenControl:false
  });

  // Trafik katmanÄ±
  trafficLayer = new google.maps.TrafficLayer();
  trafficLayer.setMap(map);

  // Trafik aÃ§/kapa
  const btn=document.getElementById('toggleBtn');
  btn.addEventListener('click', ()=>{
    const on = !!trafficLayer.getMap();
    trafficLayer.setMap(on ? null : map);
    btn.textContent = `Trafik: ${on ? 'KAPALI' : 'AÃ‡IK'}`;
    btn.setAttribute('aria-pressed', String(!on));
  });

  // Trafik panel kapatma
  document.getElementById('panelCloseBtn').addEventListener('click', closeTrafficPanel);
  // Haritaya tÄ±klayÄ±nca panel kapanabilir
  map.addListener('click', closeTrafficPanel);

  // KullanÄ±cÄ± konumu
  if(navigator.geolocation){
    navigator.geolocation.watchPosition(
      pos => {
        const loc = {lat:pos.coords.latitude, lng:pos.coords.longitude};

        if(!userHasCentered){
          map.setCenter(loc);
          map.setZoom(13);
          userHasCentered = true;
        }

        // Ä°lk kez marker oluÅŸtur
        if(!userMarker){
          userMarker = new google.maps.Marker({
            position:loc,
            map:map,
            title:"BulunduÄŸun Konum",
            icon:{
              url:"data:image/svg+xml;utf-8," +
                "<svg xmlns='http://www.w3.org/2000/svg' width='40' height='40' viewBox='0 0 40 40'>" +
                "<circle cx='20' cy='20' r='18' fill='#ffffff' stroke='#00c853' stroke-width='2' />" +
                "<rect x='10' y='16' width='20' height='10' rx='4' ry='4' fill='#00c853' />" +
                "<circle cx='15' cy='21' r='3' fill='#e8f5e9' />" +
                "<circle cx='25' cy='21' r='3' fill='#e8f5e9' />" +
                "<rect x='13' y='14' width='14' height='4' rx='2' ry='2' fill='#00e676' />" +
                "</svg>",
              scaledSize:new google.maps.Size(34,34)
            },
            zIndex:999
          });

          userCircle = new google.maps.Circle({
            strokeColor:'#00c853',
            strokeOpacity:0.35,
            strokeWeight:1,
            fillColor:'#00c853',
            fillOpacity:0.10,
            map:map,
            center:loc,
            radius:70
          });

          startCircleAnimation();
        } else {
          userMarker.setPosition(loc);
          userCircle.setCenter(loc);
        }

        updateUserStatus("Konum alÄ±ndÄ± â€¢ CanlÄ± izleniyor");
      },
      err => {
        console.log("Konum alÄ±namadÄ±:", err);
        updateUserStatus("Konum izni reddedildi");
      },
      {enableHighAccuracy:true, maximumAge:0, timeout:8000}
    );
  } else {
    updateUserStatus("Cihaz konum servisini desteklemiyor");
  }

  // Ã–rnek trafik noktalarÄ±nÄ± yÃ¼kle
  initTrafficPoints();
}

window.initMap = initMap;
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB-MpFcUMdFif1OPAGWcBhmWjWDPaM7Qz0&callback=initMap" async defer></script>
</body>
</html>
